<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Complaints - Admin</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .stats-row { display:flex; gap:18px; margin-bottom:18px; flex-wrap:wrap; }
    .stat-card { background:#fff; padding:16px; border-radius:12px; flex:1; min-width:140px; box-shadow:0 6px 18px rgba(2,6,23,0.04); text-align:center; }
    .stat-card h4 { margin:0 0 8px; color:var(--primary); font-size:1rem; font-weight:600; }
    .stat-card .value { font-size:1.8rem; font-weight:700; color:#0f1724; }
    #chartWrapper { height:280px; width:100%; max-width:420px; margin:20px auto 0; }
    .by-status { margin-top:16px; font-size:14px; }
    .by-status-item { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #eee; }
    .table { margin-top:12px; width:100%; }
    .resolve-btn { background:#00a63d; color:white; padding:6px 12px; border-radius:6px; border:none; cursor:pointer; font-size:13px; font-weight:600; }
    .resolve-btn:hover { background:#008a32; }
    .no-data { color:var(--muted); font-style:italic; text-align:center; padding:20px; }

    /* ============================
       ⭐ ADDED: VIEW MODAL STYLING
       ============================ */
    .view-modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .view-modal {
      background: white;
      width: 90%;
      max-width: 550px;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      animation: fadeIn 0.25s ease;
    }

    @keyframes fadeIn {
      from { transform: scale(0.85); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .view-modal h2 {
      margin-top: 0;
      color: var(--primary);
    }

    .close-modal {
      background: red;
      padding: 8px 14px;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      float: right;
      font-size: 14px;
      font-weight: 700;
    }

    .view-btn {
      background:#0b63d6;
      color:white;
      padding:6px 12px;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      margin-right: 6px;
    }

    .view-btn:hover { background:#084a9b; }
  </style>
</head>
<body>

  <aside class="app-sidebar" id="sidebar"></aside>

  <header class="app-header">
    <div class="brand">
      <img src="assets/logo.png" alt="Logo">
      <span>University Complaint Hub - Admin</span>
    </div>
    <div class="header-actions">
      <button class="logout" id="logoutBtn">Logout</button>
    </div>
  </header>

  <main class="app-main">
    <div class="container-card">
      <h2>All Complaints (Admin Panel)</h2>

      <div class="stats-row">
        <div class="stat-card">
          <h4>Total (All Time)</h4>
          <div class="value" id="statAllTime">0</div>
        </div>
        <div class="stat-card">
          <h4>This Month</h4>
          <div class="value" id="statThisMonth">0</div>
        </div>
        <div class="stat-card">
          <h4>New / Open</h4>
          <div class="value" id="statOpen">0</div>
        </div>
        <div class="stat-card">
          <h4>Closed / Resolved</h4>
          <div class="value" id="statClosed">0</div>
        </div>
      </div>

      <div style="display:flex; gap:24px; flex-wrap:wrap; align-items:flex-start;">
        <div style="flex:1; min-width:300px;">
          <h3>Complaints Table</h3>
          <table class="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Student</th>
                <th>Title</th>
                <th>Category</th>
                <th>Filed On</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="complaintsTableBody">
              <tr><td colspan="7" class="no-data">Loading...</td></tr>
            </tbody>
          </table>
        </div>

        <div style="width:100%; max-width:420px;">
          <h3>Status Distribution</h3>
          <div id="chartWrapper"><canvas id="statusChart"></canvas></div>

          <h3 style="margin-top:20px">Complaints by Status</h3>
          <div id="byStatusList" class="by-status">
            <div class="no-data">No data</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- ==============================
       ⭐ ADDED: VIEW MODAL STRUCTURE
       ============================== -->
  <div class="view-modal-overlay" id="viewModal">
    <div class="view-modal">
      <button class="close-modal" onclick="closeViewModal()">X</button>
      <h2>Complaint Details</h2>
      <div id="viewContent"></div>
    </div>
  </div>

  <script src="script.js"></script>

  <!-- ==============================
       ⭐ ADDED: SMALL SCRIPT
       ============================== -->
  <script>
    function openViewModal(id) {
      const all = JSON.parse(localStorage.getItem("cms_complaints")) || [];
      const c = all.find(x => x.id === id);

      if (!c) return;

      document.getElementById("viewContent").innerHTML = `
        <p><b>ID:</b> ${c.id}</p>
        <p><b>Student:</b> ${c.name}</p>
        <p><b>Title:</b> ${c.title}</p>
        <p><b>Category:</b> ${c.category}</p>
        <p><b>Status:</b> ${c.status}</p>
        <p><b>Filed On:</b> ${c.date}</p>
        ${c.resolvedOn ? `<p><b>Resolved On:</b> ${c.resolvedOn}</p>` : ""}
        <p style="margin-top:10px;"><b>Description:</b><br>${c.desc}</p>
      `;

      document.getElementById("viewModal").style.display = "flex";
    }

    function closeViewModal() {
      document.getElementById("viewModal").style.display = "none";
    }
  </script>

</body>
</html>
